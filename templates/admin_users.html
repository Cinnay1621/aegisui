<!-- aegisui/templates/admin_users.html -->
{% extends "base.html" %}
{% block content %}
<h2>Benutzerverwaltung</h2>

<form method="post" class="mb-4 d-flex gap-2">
  <input type="text" name="project_name" class="form-control" placeholder="Neues Projektname" required>
  <input type="hidden" name="action" value="add_project">
  <button class="btn btn-primary" type="submit">Projekt erstellen</button>
</form>

{% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}

<form method="post" class="mb-4 d-flex gap-2">
  <input type="text" name="username" class="form-control" placeholder="Benutzername" disabled style="display:none;">
  <input type="text" name="username" class="form-control" placeholder="Benutzername" required>
  <input type="password" name="password" class="form-control" placeholder="Passwort" required>
  <select name="role" class="form-control form-control-sm" style="width:120px; display:inline;" required>
	  <option value="guest">guest</option>
	  <option value="member" selected>member</option>
	  <option value="admin">admin</option>
  </select>
  <input type="hidden" name="action" value="add">
  <button class="btn btn-success" type="submit">Benutzer hinzufügen</button>
</form>

<table class="table table-striped table-sm">
  <thead><tr><th>ID</th><th>Benutzername</th><th>Rolle</th><th>Aktionen</th></tr></thead>
  <tbody>
  {% for u in users %}
    <tr>
      <td>{{ u['id'] }}</td>
      <td>{{ u['username'] }}</td>
      <td>
        <form method="post" class="d-inline">
          <input type="hidden" name="action" value="update">
          <input type="hidden" name="user_id" value="{{ u['id'] }}">
		  <select name="role" class="form-control form-control-sm" style="width:120px; display:inline;" required>
			  <option value="guest" {% if u['role'] == 'guest' %}selected{% endif %}>guest</option>
			  <option value="member" {% if u['role'] == 'member' %}selected{% endif %}>member</option>
			  <option value="admin" {% if u['role'] == 'admin' %}selected{% endif %}>admin</option>
		  </select>
          <button class="btn btn-sm btn-primary" type="submit">Update</button>
        </form>
      </td>
      <td>
        <form method="post" class="d-inline" onsubmit="return confirm('Benutzer wirklich löschen?');">
          <input type="hidden" name="action" value="delete">
          <input type="hidden" name="user_id" value="{{ u['id'] }}">
          <button class="btn btn-sm btn-danger" type="submit">Löschen</button>
        </form>

        <!-- Zuweisung zu Projekten -->
		<form method="post" class="d-inline" style="margin-left:8px;">
		  <input type="hidden" name="action" value="assign_to_project">
		  <input type="hidden" name="user_id" value="{{ u['id'] }}">
		  <select name="project_id" class="form-control form-control-sm" style="width:200px; display:inline;" required>
			{% for p in projects %}
			  <option value="{{ p['id'] }}">{{ p['name'] }}</option>
			{% endfor %}
		  </select>
		  <select name="role" class="form-control form-control-sm" style="width:120px; display:inline;" required>
			<option value="guest">guest</option>
			<option value="member" selected>member</option>
			<option value="manager">manager</option>
		  </select>
		  <button class="btn btn-sm btn-primary" type="submit">Zu Projekt hinzufügen</button>
		</form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<hr>
<h4>Projekte</h4>
<table class="table table-striped table-sm">
  <thead><tr><th>ID</th><th>Name</th><th>Erstellt</th><th>Bearbeiten</th></tr></thead>
  <tbody>
  {% for p in projects %}
    <tr>
      <td>{{ p['id'] }}</td>
      <td>{{ p['name'] }}</td>
      <td>{{ p['created_at'] }}</td>
      <td><a class="btn btn-sm btn-outline-primary" href="{{ url_for('project_settings', project_id=p['id']) }}">Bearbeiten</a></td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}